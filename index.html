This is the biggest code in new-feature